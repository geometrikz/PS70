<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=https://geometrikz.github.io/PS70/favicon.ico><title>Week 7: Electronic Output Devices - PS70: Intro to Digital Fabrication</title><meta name=description content="Playing around with microphones, speakers and speech-to-text"><meta name=author content="Geoffrey Liu"><meta name=generator content="Hugo 0.111.3"><link rel=stylesheet href="https://geometrikz.github.io/PS70/css/styles.min.b4ab39712f3739c39ef142c03628cc3e220d92e88bd8a2fec843cfbe6c05b8e0.css" integrity="sha256-tKs5cS83OcOe8ULANijMPiINkuiL2KL+yEPPvmwFuOA="><meta property="og:title" content="Week 7: Electronic Output Devices"><meta property="og:description" content="Playing around with microphones, speakers and speech-to-text"><meta property="og:type" content="article"><meta property="og:url" content="https://geometrikz.github.io/PS70/blog/week_7/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2023-03-13T00:00:00+00:00"><meta property="article:modified_time" content="2023-03-13T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Week 7: Electronic Output Devices"><meta name=twitter:description content="Playing around with microphones, speakers and speech-to-text"><meta itemprop=name content="Week 7: Electronic Output Devices"><meta itemprop=description content="Playing around with microphones, speakers and speech-to-text"><meta itemprop=datePublished content="2023-03-13T00:00:00+00:00"><meta itemprop=dateModified content="2023-03-13T00:00:00+00:00"><meta itemprop=wordCount content="1367"><meta itemprop=keywords content></head><body class="dark:bg-gray-800 dark:text-white relative flex flex-col min-h-screen"><header class="container flex justify-between md:justify-between gap-4 flex-wrap p-6 mx-auto relative"><a href=https://geometrikz.github.io/PS70/ class="capitalize font-extrabold text-2xl">PS70: Intro to Digital Fabrication</a>
<button class="mobile-menu-button md:hidden"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><line x1="4" y1="8" x2="20" y2="8"/><line x1="4" y1="16" x2="20" y2="16"/></svg></button><ul class="mobile-menu absolute z-10 px-6 pb-6 md:p-0 top-full left-0 w-full md:w-auto md:relative hidden md:flex flex-col md:flex-row items-end md:items-center gap-4 lg:gap-6 bg-white dark:bg-gray-800"><li><a href=https://geometrikz.github.io/PS70/blog>Project</a></li><li><a href=https://geometrikz.github.io/PS70/page/about/>About</a></li><li class="grid place-items-center"><span class="open-search inline-block cursor-pointer"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg></span></li><li class="grid place-items-center"><span class="toggle-dark-mode inline-block cursor-pointer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="3"/><line x1="12" y1="5" x2="12" y2="5.01"/><line x1="17" y1="7" x2="17" y2="7.01"/><line x1="19" y1="12" x2="19" y2="12.01"/><line x1="17" y1="17" x2="17" y2="17.01"/><line x1="12" y1="19" x2="12" y2="19.01"/><line x1="7" y1="17" x2="7" y2="17.01"/><line x1="5" y1="12" x2="5" y2="12.01"/><line x1="7" y1="7" x2="7" y2="7.01"/></svg></span></li></ul></header><main class=flex-1><div class="relative max-w-5xl mx-auto px-4"><img src=https://geometrikz.github.io/PS70/images/w7_spw2430.jpeg class="rounded-lg shadow-sm w-full object-contain"></div><div class="container flex justify-between md:justify-between gap-4 flex-wrap p-10 mx-auto relative"><article class="prose lg:prose-lg my-8 dark:prose-dark px-4 max-w-4xl mx-auto"><h1 class="text-2xl font-bold mb-2">Week 7: Electronic Output Devices</h1><details id=TableOfContents class="px-4 mt-4 bg-gray-100 dark:bg-gray-700 rounded toc"><summary class="flex items-center font-bold py-2 px-4 cursor-pointer justify-between select-none text-black dark:text-white"><span>Table of contents</span><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-down" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><polyline points="6 9 12 15 18 9"/></svg></summary><ul class="mt-2 pb-4"><li><a href=#idea-1-audio-recording-and-playback>Idea 1: Audio recording and playback</a><ul><li><a href=#getting-the-microphone-to-work>Getting the microphone to work</a><ul><li><a href=#spw2430-mems-mic>SPW2430 MEMS Mic</a></li><li><a href=#sph0645-i2s-mic>SPH0645 I2S Mic</a></li><li><a href=#inmp441-i2s-mic>INMP441 I2S Mic</a></li></ul></li><li><a href=#getting-the-speaker-to-work>Getting the speaker to work</a></li></ul></li><li><a href=#idea-2-speech-to-text>Idea 2: Speech-to-text</a></li><li><a href=#revopoint-makeup>Revopoint makeup</a></li></ul></details><p><strong>This week I was humbled by simple electronics.</strong></p><p>Since I already used the OLED in week 4, this week I decided to play around with microphones this week (although technically an input device, I got permission to use the microphone on output device week). This article will be a diary of how I was humbled by simple electronics&mldr;</p><h2 id=idea-1-audio-recording-and-playback>Idea 1: Audio recording and playback</h2><p>My first idea was to create a speech recorder that played back on a speaker using the parts we had in the lab. The first step is to get the microphone working.</p><h3 id=getting-the-microphone-to-work>Getting the microphone to work</h3><h4 id=spw2430-mems-mic>SPW2430 MEMS Mic</h4><p>We have three kinds of microphones in the lab, the first one I tried was the SPH2430 MEMS microphone. I connected the microphone to the ESP32, ran some tests to see if it would pick up a simple sine wave played from my iPhone. <em>It did not&mldr;</em> Thinking that I may just have a faulty unit, I tried again with another one and it also didn&rsquo;t work.</p><p>To figure out why it wasn&rsquo;t working, I turned to the oscilloscope and read the technical specifications. The manual says that the microphone has a 0.67V bias and the absolute maximum peak-to-peak it can record is 1V. Hooking up the microphone to the oscilloscope (Vin to 3.3V, GND to GND and DC into the oscilloscope input), the output was a flat line at around 0.67-0.7V. Setting the oscilloscope voltage bias to -0.67V got a centered reading around 0V. Playing a 440hz sine wave from my phone directly into the mic at max volume generated a near perfect 440Hz, but the peak-to-peak voltage difference was in the order or ~20mV which is way too small to be picked up by the ESP32 ADC.</p><p><img src=https://geometrikz.github.io/PS70/images/w7_spw2430.jpeg alt=oscilliscope_output></p><p>The Adafruit website said if you needed a higher peak-to-peak, &ldquo;a rail-to-rail op-amp and some resistors can get you boosted up!&rdquo; but I wasn&rsquo;t able to find a clear tutorial on how to hook up a rail-to-rail op-amp to the ESP32 ADC. I decided to try the other two microphones.</p><p><strong>Update! Mid April</strong></p><p>I managed to create an op-amp circuit for the SPW2430 to amplify the signal. Here&rsquo;s an oscilloscope reading of the amplified output and the PNG. The amplified readings are clipped (the top is cut off) since the op-amp is not rail-to-rail, but the peak-to-peak voltage is now ~0.5V which is enough to be picked up by the ESP32 ADC.</p><p><img src=https://geometrikz.github.io/PS70/images/opamp_osc.jpg alt=amplified_oscilliscope>
<img src=https://geometrikz.github.io/PS70/images/opamp_circuit.png alt=oscilliscope_circuit></p><p>The left is unamplified and the right is amplified
<img src=https://geometrikz.github.io/PS70/images/osc_prepost.jpg alt=osc_prepost></p><h4 id=sph0645-i2s-mic>SPH0645 I2S Mic</h4><p>There were some tutorial on how to hook-up this microphone, however after spending an hour and abit, I could not get this to read anything apart from 0 with two different chips. I gave up on this one and moved onto the next one.</p><h4 id=inmp441-i2s-mic>INMP441 I2S Mic</h4><p>This is the last type of microphone that the lab stocked, Google says it&rsquo;s similar to the SPH0645 I2S Mic and also wired up similarly. All the tutorials online are for the ESP32 which have different GPIO pins than the ESP32S2 Dev Kit, I found that the corresponding pins that gave me a signal are:</p><table><thead><tr><th>ESP32 Pin</th><th>INMP441 Pin</th><th>ESP32S2 Pin</th></tr></thead><tbody><tr><td>3.3V</td><td>VCC</td><td>3.3V</td></tr><tr><td>GND</td><td>GND</td><td>GND</td></tr><tr><td>25</td><td>WS</td><td>15</td></tr><tr><td>33</td><td>SD</td><td>17</td></tr><tr><td>32</td><td>SCK</td><td>16</td></tr></tbody></table><p>I followed the tutorial on this website <a href=https://dronebotworkshop.com/esp32-i2s/ target=_blank rel=noopener>https://dronebotworkshop.com/esp32-i2s/</a>
to get microphone to output a signal, albeit a wrong signal.</p><p><img src=https://geometrikz.github.io/PS70/images/w7_INMP441_wrongsignal.png alt=wrong_signal></p><p>The tutorial shows that the signal should be positive, and usually range between -3000 to 3000, but my signal was negative. I tried to figure out why, and stumbled upon this <a href=https://electronics.stackexchange.com/questions/645114/unable-to-get-any-kind-of-audio-from-i2s-inmp441-omnidirectional-microphone-on-e target=_blank rel=noopener>single stackechange post</a>
made in Dec. 2022 explaining that for IDF V4.4.3 (the ESP32 firmware) there appears to be a bug with regards to the left and right channel selection. Therefore, changing one line of code in the example, from
<code>.channel_format = I2S_CHANNEL_FMT_ONLY_LEFT</code>
to
<code>.channel_format = I2S_CHANNEL_FMT_ONLY_RIGHT</code> fixed the issue.</p><p><img src=https://geometrikz.github.io/PS70/images/w7_inmp441_correctsignal.png alt=correct_signal></p><p>After writing some code with the help of some boilerplate templates, I was able to record a <code>.wav</code> file onto the internal SPIFFS memory. I then used the arduino fileserver example code to download the .wav file onto my system.</p><h3 id=getting-the-speaker-to-work>Getting the speaker to work</h3><p>The next step is to get the speaker to play an audio recorded by the microphone. The first step was to play a <code>.wav</code> file following <a href=https://circuitdigest.com/microcontroller-projects/esp32-based-audio-player target=_blank rel=noopener>this tutorial</a>
, however I didn&rsquo;t end up getting it working. <em>I suspect that there is an issue with the library</em> since I was able to play tones using the arduino <code>tones</code> function out of the speaker, just not the example wav file from the library.</p><p>After being satisfied that there was no easy fix to play .wav files from the speaker, I gave up on the idea of playing back audio from the speaker.</p><h2 id=idea-2-speech-to-text>Idea 2: Speech-to-text</h2><p>My second idea was to use the microphone to record speech and then convert the speech to text using some kind of web-server (for the purposes of this assignment, I am generously assuming that a web-server and raspberry pi counts as an output device).</p><p>Since I already had a .wav file saved onto the internal ESP32 memory, all that&rsquo;s left to do is figure out how to upload that file to a locally hosted web-server. For this, we can use the <code>Wifi</code> library to connect to the MAKERSPACE wifi network and then use the <code>HTTPClient</code> library to upload to the a locally hosted web-server on my computer/pi. The code for this is as follows:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#6272a4>// Connect to WiFi
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>wifiConnect</span>(<span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>pvParameters){
</span></span><span style=display:flex><span>  isWIFIConnected <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>false</span>;
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>char</span><span style=color:#ff79c6>*</span> ssid <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;MAKERSPACE&#34;</span>;
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>char</span><span style=color:#ff79c6>*</span> password <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;12345678&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  WiFi.begin(ssid, password);
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>while</span>(WiFi.status() <span style=color:#ff79c6>!=</span> WL_CONNECTED){
</span></span><span style=display:flex><span>    vTaskDelay(<span style=color:#bd93f9>500</span>);
</span></span><span style=display:flex><span>    Serial.print(<span style=color:#f1fa8c>&#34;.&#34;</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  isWIFIConnected <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>true</span>;
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>while</span>(<span style=color:#8be9fd;font-style:italic>true</span>){
</span></span><span style=display:flex><span>    vTaskDelay(<span style=color:#bd93f9>1000</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// Upload file to ip_address:port
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>uploadFile</span>(){
</span></span><span style=display:flex><span>  file <span style=color:#ff79c6>=</span> SPIFFS.open(filename, FILE_READ);
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>if</span>(<span style=color:#ff79c6>!</span>file){
</span></span><span style=display:flex><span>    Serial.println(<span style=color:#f1fa8c>&#34;FILE IS NOT AVAILABLE!&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  Serial.println(<span style=color:#f1fa8c>&#34;===&gt; Upload FILE to Node.js Server&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  HTTPClient client;
</span></span><span style=display:flex><span>  client.begin(<span style=color:#f1fa8c>&#34;http://192.168.0.117:8888/uploadAudio&#34;</span>);
</span></span><span style=display:flex><span>  client.addHeader(<span style=color:#f1fa8c>&#34;Content-Type&#34;</span>, <span style=color:#f1fa8c>&#34;audio/wav&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>int</span> httpResponseCode <span style=color:#ff79c6>=</span> client.sendRequest(<span style=color:#f1fa8c>&#34;POST&#34;</span>, <span style=color:#ff79c6>&amp;</span>file, file.size());
</span></span><span style=display:flex><span>  Serial.print(<span style=color:#f1fa8c>&#34;httpResponseCode : &#34;</span>);
</span></span><span style=display:flex><span>  Serial.println(httpResponseCode);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>if</span>(httpResponseCode <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>200</span>){
</span></span><span style=display:flex><span>    String response <span style=color:#ff79c6>=</span> client.getString();
</span></span><span style=display:flex><span>    Serial.println(<span style=color:#f1fa8c>&#34;==================== Transcription ====================&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// writer(response);
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    Serial.println(response);
</span></span><span style=display:flex><span>    Serial.println(<span style=color:#f1fa8c>&#34;====================      End      ====================&#34;</span>);
</span></span><span style=display:flex><span>  }<span style=color:#ff79c6>else</span>{
</span></span><span style=display:flex><span>    Serial.println(<span style=color:#f1fa8c>&#34;Error&#34;</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  file.close();
</span></span><span style=display:flex><span>  client.end();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The web-server code is written in javascript, and is based off <a href="https://www.youtube.com/watch?v=m8LwPNXqK9o" target=_blank rel=noopener>this 5 part tutorial</a>
. It currently uses Google&rsquo;s Text-to-Speech API, but I plan to replace it with a local TTS engine run natively on the Pi using Whisper.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>var</span> fs <span style=color:#ff79c6>=</span> require(<span style=color:#f1fa8c>&#34;file-system&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> http <span style=color:#ff79c6>=</span> require(<span style=color:#f1fa8c>&#34;http&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> server <span style=color:#ff79c6>=</span> http.createServer();
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> fileName <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;./resources/recording.wav&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>server.on(<span style=color:#f1fa8c>&#34;request&#34;</span>, (request, response) =&gt; {
</span></span><span style=display:flex><span> <span style=color:#ff79c6>if</span> (request.method <span style=color:#ff79c6>==</span> <span style=color:#f1fa8c>&#34;POST&#34;</span> <span style=color:#ff79c6>&amp;&amp;</span> request.url <span style=color:#ff79c6>===</span> <span style=color:#f1fa8c>&#34;/uploadAudio&#34;</span>) {
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>var</span> recordingFile <span style=color:#ff79c6>=</span> fs.createWriteStream(fileName, { encoding<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;utf8&#34;</span> });
</span></span><span style=display:flex><span>  request.on(<span style=color:#f1fa8c>&#34;data&#34;</span>, <span style=color:#8be9fd;font-style:italic>function</span>(data) {
</span></span><span style=display:flex><span>   recordingFile.write(data);
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  request.on(<span style=color:#f1fa8c>&#34;end&#34;</span>, <span style=color:#ff79c6>async</span> <span style=color:#8be9fd;font-style:italic>function</span>() {
</span></span><span style=display:flex><span>   recordingFile.end();
</span></span><span style=display:flex><span>   <span style=color:#ff79c6>const</span> transciption <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>await</span> speechToTextAPI();
</span></span><span style=display:flex><span>   response.writeHead(<span style=color:#bd93f9>200</span>, { <span style=color:#f1fa8c>&#34;Content-Type&#34;</span><span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;text/plain&#34;</span> });
</span></span><span style=display:flex><span>   response.end(transciption);
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span> } <span style=color:#ff79c6>else</span> {
</span></span><span style=display:flex><span>  console.log(<span style=color:#f1fa8c>&#34;Error Check your POST request&#34;</span>);
</span></span><span style=display:flex><span>  response.writeHead(<span style=color:#bd93f9>405</span>, { <span style=color:#f1fa8c>&#34;Content-Type&#34;</span><span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;text/plain&#34;</span> });
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>async</span> <span style=color:#8be9fd;font-style:italic>function</span> speechToTextAPI() {
</span></span><span style=display:flex><span> <span style=color:#6272a4>// Imports the Google Cloud client library
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span> <span style=color:#ff79c6>const</span> speech <span style=color:#ff79c6>=</span> require(<span style=color:#f1fa8c>&#34;@google-cloud/speech&#34;</span>);
</span></span><span style=display:flex><span> <span style=color:#ff79c6>const</span> fs <span style=color:#ff79c6>=</span> require(<span style=color:#f1fa8c>&#34;fs&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#6272a4>// Creates a client
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span> <span style=color:#ff79c6>const</span> client <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> speech.SpeechClient();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#6272a4>// Reads a local audio file and converts it to base64
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span> <span style=color:#ff79c6>const</span> file <span style=color:#ff79c6>=</span> fs.readFileSync(fileName);
</span></span><span style=display:flex><span> <span style=color:#ff79c6>const</span> audioBytes <span style=color:#ff79c6>=</span> file.toString(<span style=color:#f1fa8c>&#34;base64&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#6272a4>// The audio file&#39;s encoding, sample rate in hertz, and BCP-47 language code
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span> <span style=color:#ff79c6>const</span> audio <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>  content<span style=color:#ff79c6>:</span> audioBytes
</span></span><span style=display:flex><span> };
</span></span><span style=display:flex><span> <span style=color:#ff79c6>const</span> config <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>  encoding<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;LINEAR16&#34;</span>,
</span></span><span style=display:flex><span>  sampleRateHertz<span style=color:#ff79c6>:</span> <span style=color:#bd93f9>16000</span>,
</span></span><span style=display:flex><span>  languageCode<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;en-US&#34;</span>
</span></span><span style=display:flex><span> };
</span></span><span style=display:flex><span> <span style=color:#ff79c6>const</span> request <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>  audio<span style=color:#ff79c6>:</span> audio,
</span></span><span style=display:flex><span>  config<span style=color:#ff79c6>:</span> config
</span></span><span style=display:flex><span> };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#6272a4>// Detects speech in the audio file
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span> <span style=color:#ff79c6>const</span> [response] <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>await</span> client.recognize(request);
</span></span><span style=display:flex><span> <span style=color:#ff79c6>const</span> transcription <span style=color:#ff79c6>=</span> response.results.map((result) =&gt; result.alternatives[<span style=color:#bd93f9>0</span>].transcript).join(<span style=color:#f1fa8c>&#34;\n&#34;</span>);
</span></span><span style=display:flex><span> console.log(<span style=color:#f1fa8c>`Transcription: </span><span style=color:#f1fa8c>${</span>transcription<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>`</span>);
</span></span><span style=display:flex><span> <span style=color:#ff79c6>return</span> transcription;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> port <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>8888</span>;
</span></span><span style=display:flex><span>server.listen(port);
</span></span><span style=display:flex><span>console.log(<span style=color:#f1fa8c>`Listening at </span><span style=color:#f1fa8c>${</span>port<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>`</span>);
</span></span></code></pre></div><p>The quality of the sound recording isn&rsquo;t terrible and TTS works quite well but could be improved with a better mic and TTS system. Here&rsquo;s some examples of my text-to-speech system in action:</p><p><img src=https://geometrikz.github.io/PS70/images/w7_tts_example.png alt=tts_example></p><p>A summary of the system:</p><ul><li>ESP32S2 records audio off INMP441 I2S microphone</li><li>Saves recording as a <code>.wav</code> file onto internal SPIFF memory</li><li>Sends <code>.wav</code> file to a locally hosted web-server</li><li>Web-server sends a compressed file to Google&rsquo;s Speech-to-Text API to convert audio to text</li><li>Web-server sends converted text back to arduino.</li></ul><h2 id=revopoint-makeup>Revopoint makeup</h2><p>I used the revopoint scanner to scan a little 3D figurine that I borrowed from Ashley. It took 3-4 scans to get a nice output. I&rsquo;ve attached a picture of the revopoint software, a picture of the final STL file and also the STL file itself.</p><p><img src=https://geometrikz.github.io/PS70/images/revopoint.png alt="Revopoint software">
<img src=https://geometrikz.github.io/PS70/images/prusa_revo.png alt="Prusa Revo">
<a href=https://geometrikz.github.io/PS70/files/dino_mesh_rgb.stl>Link to the STL file</a></p></article></div><hr class="relative h-px my-8 bg-gray-200 border-0 dark:bg-gray-700 max-w-4xl mx-auto"><div class="giscus w-full mx-auto pt-4 max-w-4xl"><script>function changeGiscusTheme(){const e=document.documentElement.getAttribute("class")==="dark"?"light":"dark";function t(e){const t=document.querySelector("iframe.giscus-frame");if(!t)return;t.contentWindow.postMessage({giscus:e},"https://giscus.app")}t({setConfig:{theme:e}})}const modeToggle=document.querySelector(".toggle-dark-mode");modeToggle&&modeToggle.addEventListener("click",changeGiscusTheme)</script><script>let giscusTheme=localStorage.getItem("darkmode"),giscusAttributes={src:"https://giscus.app/client.js","data-repo":"geometrikz/ps70","data-repo-id":"R_kgDOI6narQ","data-category":"Announcements","data-category-id":"DIC_kwDOI6narc4CUEG2","data-mapping":"title","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"top","data-theme":giscusTheme,"data-lang":"en",crossorigin:"anonymous",async:""},giscusScript=document.createElement("script");Object.entries(giscusAttributes).forEach(([e,t])=>giscusScript.setAttribute(e,t)),document.body.appendChild(giscusScript)</script></div></main><footer class="container p-6 mx-auto flex justify-between items-center"><span class="text-sm font-light">2023 © PS70: Intro to Digital Fabrication</span>
<span onclick='window.scrollTo({top:0,behavior:"smooth"})' class="p-1 cursor-pointer"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 15l-6-6-6 6h12"/></svg></span></footer><div class="search-ui absolute top-0 left-0 w-full h-full bg-white dark:bg-gray-800 hidden"><div class="container max-w-3xl mx-auto p-12"><div class=relative><div class="my-4 text-center text-2xl font-bold">Search</div><span class="p-2 absolute right-0 top-0 cursor-pointer close-search"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></span></div><input type=search class="py-2 px-3 w-full dark:text-black border dark:border-transparent" placeholder="Enter search query"><div class="search-results text-lg font-medium my-4 hidden">Results</div><ul class="search-list my-2"></ul><div class="no-results text-center my-8 hidden"><div class="text-xl font-semibold mb-2">No results found</div><p class="font-light text-sm">Try adjusting your search query</p></div></div></div><script src=https://geometrikz.github.io/PS70/js/scripts.min.js></script>
<script>const darkmode=document.querySelector(".toggle-dark-mode");function toggleDarkMode(){document.documentElement.classList.contains("dark")?(document.documentElement.classList.remove("dark"),localStorage.setItem("darkmode","light")):(document.documentElement.classList.add("dark"),localStorage.setItem("darkmode","dark"))}darkmode&&darkmode.addEventListener("click",toggleDarkMode);const darkStorage=localStorage.getItem("darkmode"),isBrowserDark=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;!darkStorage&&isBrowserDark&&document.documentElement.classList.add("dark"),darkStorage&&darkStorage==="dark"&&toggleDarkMode()</script><script>const mobileMenuButton=document.querySelector(".mobile-menu-button"),mobileMenu=document.querySelector(".mobile-menu");function toggleMenu(){mobileMenu.classList.toggle("hidden"),mobileMenu.classList.toggle("flex")}mobileMenu&&mobileMenuButton&&mobileMenuButton.addEventListener("click",toggleMenu)</script></body></html>