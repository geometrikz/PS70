<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=https://geometrikz.github.io/PS70/favicon.ico><title>Sidewalk Plotter (Team Thursday) - PS70: Intro to Digital Fabrication</title><meta name=description content="Building a drawing machine!"><meta name=author content="Geoffrey Liu"><meta name=generator content="Hugo 0.111.3"><link rel=stylesheet href="https://geometrikz.github.io/PS70/css/styles.min.b4ab39712f3739c39ef142c03628cc3e220d92e88bd8a2fec843cfbe6c05b8e0.css" integrity="sha256-tKs5cS83OcOe8ULANijMPiINkuiL2KL+yEPPvmwFuOA="><meta property="og:title" content="Sidewalk Plotter (Team Thursday)"><meta property="og:description" content="Building a drawing machine!"><meta property="og:type" content="article"><meta property="og:url" content="https://geometrikz.github.io/PS70/blog/week_10/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2023-04-12T00:00:00+00:00"><meta property="article:modified_time" content="2023-04-12T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Sidewalk Plotter (Team Thursday)"><meta name=twitter:description content="Building a drawing machine!"><meta itemprop=name content="Sidewalk Plotter (Team Thursday)"><meta itemprop=description content="Building a drawing machine!"><meta itemprop=datePublished content="2023-04-12T00:00:00+00:00"><meta itemprop=dateModified content="2023-04-12T00:00:00+00:00"><meta itemprop=wordCount content="3140"><meta itemprop=keywords content></head><body class="dark:bg-gray-800 dark:text-white relative flex flex-col min-h-screen"><header class="container flex justify-between md:justify-between gap-4 flex-wrap p-6 mx-auto relative"><a href=https://geometrikz.github.io/PS70/ class="capitalize font-extrabold text-2xl">PS70: Intro to Digital Fabrication</a>
<button class="mobile-menu-button md:hidden"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><line x1="4" y1="8" x2="20" y2="8"/><line x1="4" y1="16" x2="20" y2="16"/></svg></button><ul class="mobile-menu absolute z-10 px-6 pb-6 md:p-0 top-full left-0 w-full md:w-auto md:relative hidden md:flex flex-col md:flex-row items-end md:items-center gap-4 lg:gap-6 bg-white dark:bg-gray-800"><li><a href=https://geometrikz.github.io/PS70/blog>Project</a></li><li><a href=https://geometrikz.github.io/PS70/page/about/>About</a></li><li class="grid place-items-center"><span class="open-search inline-block cursor-pointer"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg></span></li><li class="grid place-items-center"><span class="toggle-dark-mode inline-block cursor-pointer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="3"/><line x1="12" y1="5" x2="12" y2="5.01"/><line x1="17" y1="7" x2="17" y2="7.01"/><line x1="19" y1="12" x2="19" y2="12.01"/><line x1="17" y1="17" x2="17" y2="17.01"/><line x1="12" y1="19" x2="12" y2="19.01"/><line x1="7" y1="17" x2="7" y2="17.01"/><line x1="5" y1="12" x2="5" y2="12.01"/><line x1="7" y1="7" x2="7" y2="7.01"/></svg></span></li></ul></header><main class=flex-1><div class="relative max-w-5xl mx-auto px-4"><img src=https://geometrikz.github.io/PS70/week10/featured.png class="rounded-lg shadow-sm w-full object-contain"></div><div class="container flex justify-between md:justify-between gap-4 flex-wrap p-10 mx-auto relative"><article class="prose lg:prose-lg my-8 dark:prose-dark px-4 max-w-4xl mx-auto"><h1 class="text-2xl font-bold mb-2">Sidewalk Plotter (Team Thursday)</h1><details id=TableOfContents class="px-4 mt-4 bg-gray-100 dark:bg-gray-700 rounded toc"><summary class="flex items-center font-bold py-2 px-4 cursor-pointer justify-between select-none text-black dark:text-white"><span>Table of contents</span><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-down" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><polyline points="6 9 12 15 18 9"/></svg></summary><ul class="mt-2 pb-4"><li><a href=#week-10-machine-building>Week 10: Machine Building</a><ul><li><a href=#materials>Materials</a></li><li><a href=#design-choices>Design choices</a></li><li><a href=#chassis>Chassis</a></li><li><a href=#software-and-electronics>Software and Electronics</a><ul><li><a href=#website-for-user-input>Website for User Input</a></li></ul></li><li><a href=#microcontroller-programming>Microcontroller programming</a><ul><li><a href=#end-effector>End effector</a></li></ul></li><li><a href=#end-product>End product</a></li></ul></li></ul></details><h2 id=week-10-machine-building>Week 10: Machine Building</h2><p>This week we worked in a group project to build a &ldquo;sidewalk plotter&rdquo; with the following evaluation criteria:</p><ul><li>Ability to calibrate motor position (i.e. guarantee the &ldquo;home&rdquo; position is the sam each time you power on the device)</li><li>Novelty of the end-effector / drawing technique</li><li>Precision: ability to draw a 1m-diameter circle and mark its center point</li><li>Complexity of drawing output</li></ul><h3 id=materials>Materials</h3><ul><li>Chassis<ul><li>1 12x24" sheet of 1/8" plywood</li><li>2x 80mm wheels</li><li>2 3D printed wheel mounts</li><li>2 3D printed stepper motor housing attachment</li><li>1 caster wheel</li><li>M3 hex screws</li><li>1/4" square dowel (1 feet total)</li></ul></li><li>Electronics<ul><li>2 Stepper Motors</li><li>1 MPU6050 IMU</li><li>1 Power Bank</li><li>2 Low Voltage Motor Drivers</li></ul></li><li>End effector<ul><li>1 5V 2-Channel Module with Optocoupler</li><li>1 mini air pump + tubing</li><li>1 plastic container for water</li></ul></li></ul><h3 id=design-choices>Design choices</h3><p>Since one of the criterion was to draw a 1 meter diameter circle, we did not want to make a drawing robot that was 1m long. We wanted to design a robot that was able to draw large scale images, but also compact enough to carry around. We started with the overall design and were inspired by the mobility of a <a href=https://www.irobot.com/en_US/roomba.html target=_blank rel=noopener>Roomba</a>
. The design was meant to be compact so we opted for a round double-decker shape, where the electronics would exist on one level and other components such as the water container and the battery can exist on the other level.</p><h3 id=chassis>Chassis</h3><p>The top and bottom layers were laser cut into quarter inch thick wood. The four corner holes were used for aligning the posts that separated and support the two layers. Holes for the motor cords for the water storage device and its tube allow for access to power and the liquid for the “drawing” requirement across layers. The stepper motors were attached to the main body with a 3D printed part that was found on Thingiverse and then held in place with screws. We also designed a 3D printed attachment to directly attach the 80mm wheels to the D shaped stepper motor shafts.</p><p><img src=https://geometrikz.github.io/PS70/week10/robot_plates.png alt="Robot Plates"></p><h3 id=software-and-electronics>Software and Electronics</h3><p>On the software end, there were two main parts to the code:</p><ol><li>creating the website that would translate user input into recognizable commands</li><li>programming the robot to interpret and follow those commands.</li></ol><h4 id=website-for-user-input>Website for User Input</h4><p>For user input, we wanted people to be able to draw whatever they wanted, so we had a site with a coordinate plane where they could either draw or press a button to draw a circle. To accomplish this, we use the React-p5 library to create an interactive canvas that people could draw on:</p><details><summary>Web app code (Click to reveal code)</summary><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#ff79c6>export</span> <span style=color:#ff79c6>default</span> <span style=color:#8be9fd;font-style:italic>function</span> Canvas(props) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>const</span> setup <span style=color:#ff79c6>=</span> (p5, canvasParentRef) =&gt; {
</span></span><span style=display:flex><span>        p5.createCanvas(props.width, props.height).parent(canvasParentRef)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>const</span> mp <span style=color:#ff79c6>=</span> (e) =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> (e.mouseY <span style=color:#ff79c6>&gt;</span> <span style=color:#bd93f9>620</span> <span style=color:#ff79c6>||</span> e.mouseY <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>0</span> <span style=color:#ff79c6>||</span> e.mouseX <span style=color:#ff79c6>&gt;</span> <span style=color:#bd93f9>1080</span> <span style=color:#ff79c6>||</span> e.mouseX <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>0</span>) {
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>return</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        mouseX <span style=color:#ff79c6>=</span> e.mouseX;
</span></span><span style=display:flex><span>        mouseY <span style=color:#ff79c6>=</span> e.mouseY;
</span></span><span style=display:flex><span>        props.x_coordinates.push(mouseX);
</span></span><span style=display:flex><span>        props.y_coordinates.push(mouseY);
</span></span><span style=display:flex><span>        props.pen.push(<span style=color:#bd93f9>1</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>const</span> draw <span style=color:#ff79c6>=</span> (p5) =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> (props.clear) {
</span></span><span style=display:flex><span>            p5.clear();
</span></span><span style=display:flex><span>            props.clearHandler();
</span></span><span style=display:flex><span>            mouseX<span style=color:#ff79c6>=</span><span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>            mouseY<span style=color:#ff79c6>=</span><span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>            pmouseX<span style=color:#ff79c6>=</span><span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>            pmouseY<span style=color:#ff79c6>=</span><span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        p5.background(<span style=color:#bd93f9>255</span>, <span style=color:#bd93f9>0</span>);
</span></span><span style=display:flex><span>        p5.line(mouseX, mouseY, pmouseX, pmouseY);
</span></span><span style=display:flex><span>        pmouseX <span style=color:#ff79c6>=</span> mouseX;
</span></span><span style=display:flex><span>        pmouseY <span style=color:#ff79c6>=</span> mouseY;
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>&lt;</span>Sketch setup<span style=color:#ff79c6>=</span>{setup} draw<span style=color:#ff79c6>=</span>{draw} mousePressed<span style=color:#ff79c6>=</span>{mp} <span style=color:#ff79c6>/&gt;</span>;
</span></span><span style=display:flex><span>};
</span></span></code></pre></div></details><p>We then embedded this within a site built on React. Using event handlers and the Javascript Fetch API, the site records a list of coordinates where the user has clicked and sends them to the API when the appropriate button is clicked:</p><details><summary>Web API Code (Click to reveal code)</summary><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>function</span> App() {
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> [clear, setClear] <span style=color:#ff79c6>=</span> useState(<span style=color:#ff79c6>false</span>);
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>let</span> array1 <span style=color:#ff79c6>=</span> [];
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>let</span> array2 <span style=color:#ff79c6>=</span> [];
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>let</span> array3 <span style=color:#ff79c6>=</span> [];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> clearHandler <span style=color:#ff79c6>=</span> () =&gt; {
</span></span><span style=display:flex><span>    setClear(<span style=color:#ff79c6>false</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> handleClick <span style=color:#ff79c6>=</span> (circle) =&gt; {
</span></span><span style=display:flex><span>    setClear(<span style=color:#ff79c6>true</span>);
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>let</span> today <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> <span style=color:#8be9fd;font-style:italic>Date</span>(),
</span></span><span style=display:flex><span>      time <span style=color:#ff79c6>=</span> today.getHours() <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>&#39;:&#39;</span> <span style=color:#ff79c6>+</span> today.getMinutes() <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>&#39;:&#39;</span> <span style=color:#ff79c6>+</span> today.getSeconds();
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>let</span> jsonData;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> (circle) {
</span></span><span style=display:flex><span>      jsonData <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;x_coordinates&#34;</span><span style=color:#ff79c6>:</span> array1,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;y_coordinates&#34;</span><span style=color:#ff79c6>:</span> array2,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;pen&#34;</span><span style=color:#ff79c6>:</span> array3,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;time&#34;</span><span style=color:#ff79c6>:</span> time,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;circle&#34;</span><span style=color:#ff79c6>:</span> <span style=color:#ff79c6>true</span>
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    } <span style=color:#ff79c6>else</span> {
</span></span><span style=display:flex><span>      jsonData <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;x_coordinates&#34;</span><span style=color:#ff79c6>:</span> array1,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;y_coordinates&#34;</span><span style=color:#ff79c6>:</span> array2,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;pen&#34;</span><span style=color:#ff79c6>:</span> array3,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;time&#34;</span><span style=color:#ff79c6>:</span> time,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;circle&#34;</span><span style=color:#ff79c6>:</span> <span style=color:#ff79c6>false</span>
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    jsonData <span style=color:#ff79c6>=</span> JSON.stringify(jsonData);
</span></span><span style=display:flex><span>    console.log(jsonData);
</span></span><span style=display:flex><span>    fetch(<span style=color:#f1fa8c>&#39;https://ps70-api.vercel.app/&#39;</span>, {
</span></span><span style=display:flex><span>      method<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#39;POST&#39;</span>,
</span></span><span style=display:flex><span>      mode<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#39;cors&#39;</span>,
</span></span><span style=display:flex><span>      headers<span style=color:#ff79c6>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#39;Accept&#39;</span><span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#39;application/json&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#39;Content-Type&#39;</span><span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#39;application/json&#39;</span>
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      body<span style=color:#ff79c6>:</span> jsonData
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>      .then(response =&gt; console.log(response))
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>return</span> (
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>&lt;</span>div <span style=color:#ff79c6>class</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;App&#34;</span><span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>&lt;</span>h1<span style=color:#ff79c6>&gt;</span>PS70 Sidewalk Plotter App<span style=color:#ff79c6>&lt;</span>/h1&gt;
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>&lt;</span>h3<span style=color:#ff79c6>&gt;</span>Draw what you want to create below<span style=color:#ff79c6>!&lt;</span>/h3&gt;
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>&lt;</span>div <span style=color:#ff79c6>class</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;container&#34;</span><span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&lt;</span>img src<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;https://img.freepik.com/free-vector/abstract-horizontal-grid-lines-graph-style-graphic-design_1017-39918.jpg?w=1080&#34;</span> alt<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;Grid&#34;</span> <span style=color:#ff79c6>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&lt;</span>Canvas width<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;1080&#34;</span> height<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;600&#34;</span> x_coordinates<span style=color:#ff79c6>=</span>{array1} y_coordinates<span style=color:#ff79c6>=</span>{array2} pen<span style=color:#ff79c6>=</span>{array3} clear<span style=color:#ff79c6>=</span>{clear} clearHandler<span style=color:#ff79c6>=</span>{clearHandler} <span style=color:#ff79c6>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>&lt;</span>/div&gt;
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>&lt;</span>button <span style=color:#ff79c6>class</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;button-green&#34;</span> onClick<span style=color:#ff79c6>=</span>{() =&gt; handleClick(<span style=color:#ff79c6>false</span>)}<span style=color:#ff79c6>&gt;</span>Send to Plotter<span style=color:#ff79c6>&lt;</span>/button&gt;
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>&lt;</span>button <span style=color:#ff79c6>class</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;button-blue&#34;</span> onClick<span style=color:#ff79c6>=</span>{() =&gt; handleClick(<span style=color:#ff79c6>true</span>)}<span style=color:#ff79c6>&gt;</span>Draw Circle ⚪<span style=color:#ff79c6>&lt;</span>/button&gt;
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>&lt;</span>button <span style=color:#ff79c6>class</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;button-red&#34;</span> onClick<span style=color:#ff79c6>=</span>{() =&gt; setClear(<span style=color:#ff79c6>true</span>)}<span style=color:#ff79c6>&gt;</span>Clear<span style=color:#ff79c6>&lt;</span>/button&gt;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>&lt;</span>/div&gt;
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>export</span> <span style=color:#ff79c6>default</span> App;
</span></span></code></pre></div></details><p>Feel free to check out what the final site looks like here!</p><p>That would send a set of coordinates to an API, which we then had to convert into instructions for the robot in the form “turn x degrees, then move y centimeters.” We did this through some fun geometry and two classes:</p><details><summary>Co-ordinate processing (Click to reveal code)</summary><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#ff79c6>class</span> Point {
</span></span><span style=display:flex><span>  constructor(ls) {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>this</span>.x <span style=color:#ff79c6>=</span> ls[<span style=color:#bd93f9>0</span>];
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>this</span>.y <span style=color:#ff79c6>=</span> ls[<span style=color:#bd93f9>1</span>];
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  distance(other) {
</span></span><span style=display:flex><span>    <span style=color:#6272a4>/*
</span></span></span><span style=display:flex><span><span style=color:#6272a4>      * Gets distance between current point and new point
</span></span></span><span style=display:flex><span><span style=color:#6272a4>      */</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> <span style=color:#8be9fd;font-style:italic>Math</span>.sqrt(<span style=color:#8be9fd;font-style:italic>Math</span>.pow(<span style=color:#ff79c6>this</span>.x <span style=color:#ff79c6>-</span> other.x, <span style=color:#bd93f9>2</span>) <span style=color:#ff79c6>+</span> <span style=color:#8be9fd;font-style:italic>Math</span>.pow(<span style=color:#ff79c6>this</span>.y <span style=color:#ff79c6>-</span> other.y, <span style=color:#bd93f9>2</span>));
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  angle(other) {
</span></span><span style=display:flex><span>    <span style=color:#6272a4>/*
</span></span></span><span style=display:flex><span><span style=color:#6272a4>      * Gets angle between current point and new point
</span></span></span><span style=display:flex><span><span style=color:#6272a4>      * If facing east, how many degrees to turn counterclockwise to face new point
</span></span></span><span style=display:flex><span><span style=color:#6272a4>      */</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> (<span style=color:#ff79c6>this</span>.x <span style=color:#ff79c6>===</span> other.x) {
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>return</span> (<span style=color:#ff79c6>this</span>.y <span style=color:#ff79c6>&lt;</span> other.y <span style=color:#ff79c6>?</span> <span style=color:#bd93f9>90</span> <span style=color:#ff79c6>:</span> <span style=color:#bd93f9>270</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>const</span> slope <span style=color:#ff79c6>=</span> (<span style=color:#ff79c6>this</span>.y <span style=color:#ff79c6>-</span> other.y) <span style=color:#ff79c6>/</span> (<span style=color:#ff79c6>this</span>.x <span style=color:#ff79c6>-</span> other.x)
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>const</span> angle <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>Math</span>.atan(slope) <span style=color:#ff79c6>*</span> (<span style=color:#bd93f9>180</span> <span style=color:#ff79c6>/</span> <span style=color:#8be9fd;font-style:italic>Math</span>.PI);
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> (<span style=color:#ff79c6>this</span>.x <span style=color:#ff79c6>&gt;</span> other.x) {
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>return</span> <span style=color:#bd93f9>180</span> <span style=color:#ff79c6>+</span> angle;
</span></span><span style=display:flex><span>    } <span style=color:#ff79c6>else</span> {
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>return</span> <span style=color:#bd93f9>360</span> <span style=color:#ff79c6>+</span> angle;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  toString() {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> <span style=color:#f1fa8c>`(</span><span style=color:#f1fa8c>${</span><span style=color:#ff79c6>this</span>.x<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>, </span><span style=color:#f1fa8c>${</span><span style=color:#ff79c6>this</span>.y<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>)`</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>module.exports <span style=color:#ff79c6>=</span> Point;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#ff79c6>class</span> Robot {
</span></span><span style=display:flex><span>  constructor() {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>this</span>.position <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> Point([<span style=color:#bd93f9>0</span>, <span style=color:#bd93f9>0</span>]);
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>this</span>.angle <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  get_distance(coordinate) {
</span></span><span style=display:flex><span>    <span style=color:#6272a4>/*
</span></span></span><span style=display:flex><span><span style=color:#6272a4>      * Gets distance robot needs to travel
</span></span></span><span style=display:flex><span><span style=color:#6272a4>      */</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>this</span>.position.distance(coordinate);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  get_angle(coordinate) {
</span></span><span style=display:flex><span>    <span style=color:#6272a4>/*
</span></span></span><span style=display:flex><span><span style=color:#6272a4>      * Gets angle between current angle and new angle to turn to
</span></span></span><span style=display:flex><span><span style=color:#6272a4>      * adjusts this to be between -180 and 180 to avoid unnecessary turns
</span></span></span><span style=display:flex><span><span style=color:#6272a4>      */</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>const</span> angle <span style=color:#ff79c6>=</span> (<span style=color:#ff79c6>this</span>.position.angle(coordinate) <span style=color:#ff79c6>-</span> <span style=color:#ff79c6>this</span>.angle) <span style=color:#ff79c6>%</span> <span style=color:#bd93f9>360</span>;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> (<span style=color:#8be9fd;font-style:italic>Math</span>.abs(angle) <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>180</span>) {
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>return</span> angle;
</span></span><span style=display:flex><span>    } <span style=color:#ff79c6>else</span> <span style=color:#ff79c6>if</span> (angle <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>0</span>) {
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>return</span> <span style=color:#bd93f9>360</span> <span style=color:#ff79c6>+</span> angle;
</span></span><span style=display:flex><span>    } <span style=color:#ff79c6>else</span> {
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>return</span> angle <span style=color:#ff79c6>-</span> <span style=color:#bd93f9>360</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  moveto(coordinate) {
</span></span><span style=display:flex><span>    <span style=color:#6272a4>/*
</span></span></span><span style=display:flex><span><span style=color:#6272a4>      * Updates robot&#39;s position and angle to new values
</span></span></span><span style=display:flex><span><span style=color:#6272a4>      * Returns the command 
</span></span></span><span style=display:flex><span><span style=color:#6272a4>      */</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>const</span> angle_change <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>this</span>.get_angle(coordinate);
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>const</span> distance_change <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>this</span>.get_distance(coordinate);
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>this</span>.position <span style=color:#ff79c6>=</span> coordinate;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>this</span>.angle <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>this</span>.angle <span style=color:#ff79c6>+</span> angle_change;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> {
</span></span><span style=display:flex><span>      angle<span style=color:#ff79c6>:</span> angle_change,
</span></span><span style=display:flex><span>      distance<span style=color:#ff79c6>:</span> distance_change
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  generateInstructions(coordinates) {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>const</span> instructions <span style=color:#ff79c6>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>for</span> (<span style=color:#ff79c6>const</span> c <span style=color:#ff79c6>of</span> coordinates) {
</span></span><span style=display:flex><span>      <span style=color:#8be9fd;font-style:italic>let</span> instruct <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>this</span>.moveto(<span style=color:#ff79c6>new</span> Point(c.slice(<span style=color:#bd93f9>0</span>, <span style=color:#bd93f9>2</span>)));
</span></span><span style=display:flex><span>      instruct.pendown <span style=color:#ff79c6>=</span> c[<span style=color:#bd93f9>2</span>];
</span></span><span style=display:flex><span>      instructions.push(instruct);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> instructions;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>module.exports <span style=color:#ff79c6>=</span> Robot;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#ff79c6>const</span> express <span style=color:#ff79c6>=</span> require(<span style=color:#f1fa8c>&#39;express&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> cors<span style=color:#ff79c6>=</span>require(<span style=color:#f1fa8c>&#34;cors&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> Robot <span style=color:#ff79c6>=</span> require(<span style=color:#f1fa8c>&#39;./Robot&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> app <span style=color:#ff79c6>=</span> express();
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> port <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>3000</span>;
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>let</span> output <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>  instructions<span style=color:#ff79c6>:</span> [],
</span></span><span style=display:flex><span>  id<span style=color:#ff79c6>:</span> <span style=color:#bd93f9>0</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>let</span> current_gyro <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>  x<span style=color:#ff79c6>:</span> <span style=color:#bd93f9>0</span>,
</span></span><span style=display:flex><span>  y<span style=color:#ff79c6>:</span> <span style=color:#bd93f9>0</span>,
</span></span><span style=display:flex><span>  z<span style=color:#ff79c6>:</span> <span style=color:#bd93f9>0</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app.use(express.json());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> corsOptions <span style=color:#ff79c6>=</span>{
</span></span><span style=display:flex><span>   origin<span style=color:#ff79c6>:</span><span style=color:#f1fa8c>&#39;*&#39;</span>, 
</span></span><span style=display:flex><span>   credentials<span style=color:#ff79c6>:</span><span style=color:#ff79c6>true</span>,            
</span></span><span style=display:flex><span>   optionSuccessStatus<span style=color:#ff79c6>:</span><span style=color:#bd93f9>200</span>,
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>function</span> getRandomInt(min, max) {
</span></span><span style=display:flex><span>  min <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>Math</span>.ceil(min);
</span></span><span style=display:flex><span>  max <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>Math</span>.floor(max);
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>return</span> <span style=color:#8be9fd;font-style:italic>Math</span>.floor(<span style=color:#8be9fd;font-style:italic>Math</span>.random() <span style=color:#ff79c6>*</span> (max <span style=color:#ff79c6>-</span> min <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>1</span>)) <span style=color:#ff79c6>+</span> min;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app.use(cors(corsOptions))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app.post(<span style=color:#f1fa8c>&#39;/gyro&#39;</span>, (req, res) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>let</span> euler_x <span style=color:#ff79c6>=</span> req.body.euler_x <span style=color:#ff79c6>*</span> <span style=color:#bd93f9>180</span> <span style=color:#ff79c6>/</span> <span style=color:#8be9fd;font-style:italic>Math</span>.PI;
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>let</span> euler_y <span style=color:#ff79c6>=</span> req.body.euler_y <span style=color:#ff79c6>*</span> <span style=color:#bd93f9>180</span> <span style=color:#ff79c6>/</span> <span style=color:#8be9fd;font-style:italic>Math</span>.PI;
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>let</span> euler_z <span style=color:#ff79c6>=</span> req.body.euler_z <span style=color:#ff79c6>*</span> <span style=color:#bd93f9>180</span> <span style=color:#ff79c6>/</span> <span style=color:#8be9fd;font-style:italic>Math</span>.PI;
</span></span><span style=display:flex><span>  current_gyro <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>    x<span style=color:#ff79c6>:</span> euler_x,
</span></span><span style=display:flex><span>    y<span style=color:#ff79c6>:</span> euler_y,
</span></span><span style=display:flex><span>    z<span style=color:#ff79c6>:</span> euler_z,
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  res.send(<span style=color:#f1fa8c>`Set gyro to </span><span style=color:#f1fa8c>${</span>current_gyro<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>`</span>);
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app.get(<span style=color:#f1fa8c>&#39;/gyro&#39;</span>, (req, res) =&gt; {
</span></span><span style=display:flex><span>  res.send(current_gyro);
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app.get(<span style=color:#f1fa8c>&#39;/&#39;</span>, (req, res) =&gt; {
</span></span><span style=display:flex><span>  res.send(output);
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app.post(<span style=color:#f1fa8c>&#39;/&#39;</span>, (req, res) =&gt; {
</span></span><span style=display:flex><span>  console.log(req.body);
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> xdata <span style=color:#ff79c6>=</span> req.body.x_coordinates;
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> ydata <span style=color:#ff79c6>=</span> req.body.y_coordinates;
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> pen <span style=color:#ff79c6>=</span> req.body.pen;
</span></span><span style=display:flex><span>  <span style=color:#6272a4>//const time = req.body.time;
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#8be9fd;font-style:italic>let</span> coordinates <span style=color:#ff79c6>=</span> [];
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>for</span> (<span style=color:#8be9fd;font-style:italic>let</span> i <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>; i <span style=color:#ff79c6>&lt;</span> xdata.length; i<span style=color:#ff79c6>++</span>) {
</span></span><span style=display:flex><span>    coordinates.push([xdata[i] <span style=color:#ff79c6>*</span> <span style=color:#bd93f9>2</span>, ydata[i] <span style=color:#ff79c6>*</span> <span style=color:#bd93f9>2</span>, pen[i]]);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> robbo <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> Robot();
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> instructions <span style=color:#ff79c6>=</span> robbo.generateInstructions(coordinates);
</span></span><span style=display:flex><span>  <span style=color:#8be9fd;font-style:italic>let</span> t <span style=color:#ff79c6>=</span> getRandomInt(<span style=color:#bd93f9>0</span>, <span style=color:#bd93f9>10000</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>if</span> (req.body.circle) {
</span></span><span style=display:flex><span>    t <span style=color:#ff79c6>=</span> t <span style=color:#ff79c6>*</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>;
</span></span><span style=display:flex><span>    output <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>      instructions<span style=color:#ff79c6>:</span> instructions,
</span></span><span style=display:flex><span>      id<span style=color:#ff79c6>:</span> t
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  } <span style=color:#ff79c6>else</span> {
</span></span><span style=display:flex><span>    output <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>      instructions<span style=color:#ff79c6>:</span> instructions,
</span></span><span style=display:flex><span>      id<span style=color:#ff79c6>:</span> t
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  res.send(<span style=color:#f1fa8c>`Set data to </span><span style=color:#f1fa8c>${</span>output<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>`</span>);
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app.listen(port, () =&gt; {
</span></span><span style=display:flex><span>  console.log(<span style=color:#f1fa8c>`API Started On Port </span><span style=color:#f1fa8c>${</span>port<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>`</span>);
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>module.exports <span style=color:#ff79c6>=</span> app;
</span></span></code></pre></div></details><p>If you are interested, the final API can be accessed <a href=https://ps70-api.vercel.app/ target=_blank rel=noopener>here</a>
.</p><h3 id=microcontroller-programming>Microcontroller programming</h3><p>For this part, we split the code into two classes: one that reads data from the gyroscope and one that controls the two stepper motors. The MPU6050 library we used has not been updated in a long time, and we ended up having to modify some of the source files in order to make it its own class, but we eventually got it working:</p><details><summary>Microprocessor (Click to reveal code)</summary><p><strong>Gyro.h:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#ff79c6># ifndef GYRO_H
</span></span></span><span style=display:flex><span><span style=color:#ff79c6># define GYRO_H
</span></span></span><span style=display:flex><span><span style=color:#ff79c6># include &lt;WiFi.h&gt;
</span></span></span><span style=display:flex><span><span style=color:#ff79c6># include &lt;HTTPClient.h&gt;
</span></span></span><span style=display:flex><span><span style=color:#ff79c6># include &lt;ArduinoJson.h&gt;
</span></span></span><span style=display:flex><span><span style=color:#ff79c6># include &lt;WebServer.h&gt;
</span></span></span><span style=display:flex><span><span style=color:#ff79c6># include &#34;helper_3dmath.h&#34;
</span></span></span><span style=display:flex><span><span style=color:#ff79c6># include &#34;Wire.h&#34;
</span></span></span><span style=display:flex><span><span style=color:#ff79c6># include &#34;I2Cdev.h&#34;
</span></span></span><span style=display:flex><span><span style=color:#ff79c6># include &#34;MPU6050_6Axis_MotionApps20.h&#34;
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>Gyro</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>private</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span>    MPU6050 mpu;
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>bool</span> dmpReady;  <span style=color:#6272a4>// set true if DMP init was successful
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>uint8_t</span> mpuIntStatus;   <span style=color:#6272a4>// holds actual interrupt status byte from MPU
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>uint8_t</span> devStatus;      <span style=color:#6272a4>// return status after each device operation (0 = success, !0 = error)
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>uint16_t</span> packetSize;    <span style=color:#6272a4>// expected DMP packet size (default is 42 bytes)
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>uint16_t</span> fifoCount;     <span style=color:#6272a4>// count of all bytes currently in FIFO
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>uint8_t</span> fifoBuffer[<span style=color:#bd93f9>64</span>]; <span style=color:#6272a4>// FIFO storage buffer
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    Quaternion q;           <span style=color:#6272a4>// [w, x, y, z]         quaternion container
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    VectorInt16 aa;         <span style=color:#6272a4>// [x, y, z]            accel sensor measurements
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    VectorInt16 aaReal;     <span style=color:#6272a4>// [x, y, z]            gravity-free accel sensor measurements
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    VectorInt16 aaWorld;    <span style=color:#6272a4>// [x, y, z]            world-frame accel sensor measurements
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    VectorFloat gravity;    <span style=color:#6272a4>// [x, y, z]            gravity vector
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>float</span> euler[<span style=color:#bd93f9>3</span>];         <span style=color:#6272a4>// [psi, theta, phi]    Euler angle container
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>float</span> ypr[<span style=color:#bd93f9>3</span>];           <span style=color:#6272a4>// [yaw, pitch, roll]   yaw/pitch/roll container and gravity vector
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>volatile</span> <span style=color:#8be9fd>bool</span> mpuInterrupt;
</span></span><span style=display:flex><span>    StaticJsonDocument<span style=color:#ff79c6>&lt;</span><span style=color:#bd93f9>250</span><span style=color:#ff79c6>&gt;</span> jsonDocument;
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>char</span> buffer[<span style=color:#bd93f9>250</span>];
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>int</span> interrupt_pin;
</span></span><span style=display:flex><span>    String gyroURL;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>public</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span>    Gyro(String url);
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>static</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>dmpDataReady</span>();
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>create_json</span>(<span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>tag, <span style=color:#8be9fd>float</span><span style=color:#ff79c6>*</span>value, <span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>unit);
</span></span><span style=display:flex><span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>add_json_object</span>(<span style=color:#8be9fd>char</span><span style=color:#ff79c6>*</span>tag, <span style=color:#8be9fd>float</span> value, <span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>unit);
</span></span><span style=display:flex><span><span style=color:#8be9fd>char</span><span style=color:#ff79c6>*</span><span style=color:#50fa7b>getEuler</span>();
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>gyroSetup</span>();
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>updateGyro</span>();
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>sendGyro</span>();
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>float</span> <span style=color:#50fa7b>getCurrentAngle</span>();
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6># endif
</span></span></span></code></pre></div><p><strong>Gyro.cpp:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#ff79c6># include &#34;Gyro.h&#34;
</span></span></span><span style=display:flex><span><span style=color:#ff79c6># include &#34;MPU6050_6Axis_MotionApps20.h&#34;
</span></span></span><span style=display:flex><span><span style=color:#ff79c6># include &lt;WiFi.h&gt;
</span></span></span><span style=display:flex><span><span style=color:#ff79c6># include &lt;HTTPClient.h&gt;
</span></span></span><span style=display:flex><span><span style=color:#ff79c6># include &lt;ArduinoJson.h&gt;
</span></span></span><span style=display:flex><span><span style=color:#ff79c6># include &lt;WebServer.h&gt;
</span></span></span><span style=display:flex><span><span style=color:#ff79c6># include &#34;I2Cdev.h&#34;
</span></span></span><span style=display:flex><span><span style=color:#ff79c6># include &#34;Wire.h&#34;
</span></span></span><span style=display:flex><span><span style=color:#ff79c6># define PI 3.1415926535897932384626433832795
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span>Gyro <span style=color:#ff79c6>::</span> Gyro(String url) {
</span></span><span style=display:flex><span>  gyroURL <span style=color:#ff79c6>=</span> url;
</span></span><span style=display:flex><span>  dmpReady <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>false</span>;
</span></span><span style=display:flex><span>  mpuInterrupt <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>false</span>;
</span></span><span style=display:flex><span>  interrupt_pin <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>2</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#8be9fd>void</span> Gyro <span style=color:#ff79c6>::</span> dmpDataReady() {
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>return</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#8be9fd>void</span> Gyro <span style=color:#ff79c6>::</span> create_json(<span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>tag, <span style=color:#8be9fd>float</span><span style=color:#ff79c6>*</span>value, <span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>unit) {
</span></span><span style=display:flex><span>  jsonDocument.clear();
</span></span><span style=display:flex><span>  jsonDocument[<span style=color:#f1fa8c>&#34;type&#34;</span>] <span style=color:#ff79c6>=</span> tag;
</span></span><span style=display:flex><span>  jsonDocument[<span style=color:#f1fa8c>&#34;euler_x&#34;</span>] <span style=color:#ff79c6>=</span> value[<span style=color:#bd93f9>0</span>];
</span></span><span style=display:flex><span>  jsonDocument[<span style=color:#f1fa8c>&#34;euler_y&#34;</span>] <span style=color:#ff79c6>=</span> value[<span style=color:#bd93f9>1</span>];
</span></span><span style=display:flex><span>  jsonDocument[<span style=color:#f1fa8c>&#34;euler_z&#34;</span>] <span style=color:#ff79c6>=</span> value[<span style=color:#bd93f9>2</span>];
</span></span><span style=display:flex><span>  jsonDocument[<span style=color:#f1fa8c>&#34;unit&#34;</span>] <span style=color:#ff79c6>=</span> unit;
</span></span><span style=display:flex><span>  serializeJson(jsonDocument, buffer);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#8be9fd>void</span> Gyro <span style=color:#ff79c6>::</span> add_json_object(<span style=color:#8be9fd>char</span><span style=color:#ff79c6>*</span>tag, <span style=color:#8be9fd>float</span> value, <span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>unit) {
</span></span><span style=display:flex><span>  JsonObject obj <span style=color:#ff79c6>=</span> jsonDocument.createNestedObject();
</span></span><span style=display:flex><span>  obj[<span style=color:#f1fa8c>&#34;type&#34;</span>] <span style=color:#ff79c6>=</span> tag;
</span></span><span style=display:flex><span>  obj[<span style=color:#f1fa8c>&#34;value&#34;</span>] <span style=color:#ff79c6>=</span> value;
</span></span><span style=display:flex><span>  obj[<span style=color:#f1fa8c>&#34;unit&#34;</span>] <span style=color:#ff79c6>=</span> unit;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#8be9fd>char</span><span style=color:#ff79c6>*</span>Gyro <span style=color:#ff79c6>::</span> getEuler() {
</span></span><span style=display:flex><span>  create_json(<span style=color:#f1fa8c>&#34;euler_x&#34;</span>, euler, <span style=color:#f1fa8c>&#34;degrees&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>return</span> buffer;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>void</span> Gyro <span style=color:#ff79c6>::</span> sendGyro() {
</span></span><span style=display:flex><span>  HTTPClient http;
</span></span><span style=display:flex><span>  <span style=color:#6272a4>// Your Domain name with URL path or IP address with path
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  http.begin(gyroURL);
</span></span><span style=display:flex><span>  updateGyro();
</span></span><span style=display:flex><span>  create_json(<span style=color:#f1fa8c>&#34;euler_x&#34;</span>, euler, <span style=color:#f1fa8c>&#34;degrees&#34;</span>);
</span></span><span style=display:flex><span>  http.addHeader(<span style=color:#f1fa8c>&#34;Content-Type&#34;</span>, <span style=color:#f1fa8c>&#34;application/json&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>int</span> httpResponseCode <span style=color:#ff79c6>=</span> http.POST(buffer);
</span></span><span style=display:flex><span>  http.end();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>float</span> Gyro <span style=color:#ff79c6>::</span> getCurrentAngle() {
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>return</span> euler[<span style=color:#bd93f9>0</span>] <span style=color:#ff79c6>*</span> <span style=color:#bd93f9>180</span> <span style=color:#ff79c6>/</span> PI;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>void</span> Gyro <span style=color:#ff79c6>::</span> gyroSetup() {
</span></span><span style=display:flex><span>  Wire.begin(<span style=color:#bd93f9>12</span>, <span style=color:#bd93f9>13</span>);
</span></span><span style=display:flex><span>  mpu.initialize();
</span></span><span style=display:flex><span>  pinMode(interrupt_pin, INPUT);
</span></span><span style=display:flex><span>  devStatus <span style=color:#ff79c6>=</span> mpu.dmpInitialize();
</span></span><span style=display:flex><span>  mpu.setXGyroOffset(<span style=color:#bd93f9>90</span>);
</span></span><span style=display:flex><span>  mpu.setYGyroOffset(<span style=color:#bd93f9>44</span>);
</span></span><span style=display:flex><span>  mpu.setZGyroOffset(<span style=color:#bd93f9>10</span>);
</span></span><span style=display:flex><span>  mpu.setZAccelOffset(<span style=color:#bd93f9>1060</span>); <span style=color:#6272a4>// 1688 factory default for my test chip
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  mpu.setXAccelOffset(<span style=color:#bd93f9>1491</span>);
</span></span><span style=display:flex><span>  mpu.setYAccelOffset(<span style=color:#ff79c6>-</span><span style=color:#bd93f9>5467</span>);
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>if</span> (devStatus <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>0</span>) {
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// Calibration Time: generate offsets and calibrate our MPU6050
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    mpu.CalibrateAccel(<span style=color:#bd93f9>10</span>);
</span></span><span style=display:flex><span>    mpu.CalibrateGyro(<span style=color:#bd93f9>10</span>);
</span></span><span style=display:flex><span>    mpu.PrintActiveOffsets();
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// turn on the DMP, now that it&#39;s ready
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    Serial.println(F(<span style=color:#f1fa8c>&#34;Enabling DMP...&#34;</span>));
</span></span><span style=display:flex><span>    mpu.setDMPEnabled(<span style=color:#8be9fd;font-style:italic>true</span>);
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// enable Arduino interrupt detection
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    Serial.print(F(<span style=color:#f1fa8c>&#34;Enabling interrupt detection (Arduino external interrupt &#34;</span>));
</span></span><span style=display:flex><span>    Serial.print(digitalPinToInterrupt(interrupt_pin));
</span></span><span style=display:flex><span>    Serial.println(F(<span style=color:#f1fa8c>&#34;)...&#34;</span>));
</span></span><span style=display:flex><span>    attachInterrupt(digitalPinToInterrupt(interrupt_pin), dmpDataReady, RISING);
</span></span><span style=display:flex><span>    mpuInterrupt <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>true</span>;
</span></span><span style=display:flex><span>    mpuIntStatus <span style=color:#ff79c6>=</span> mpu.getIntStatus();
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// set our DMP Ready flag so the main loop() function knows it&#39;s okay to use it
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    Serial.println(F(<span style=color:#f1fa8c>&#34;DMP ready! Waiting for first interrupt...&#34;</span>));
</span></span><span style=display:flex><span>    dmpReady <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>true</span>;
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// get expected DMP packet size for later comparison
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    packetSize <span style=color:#ff79c6>=</span> mpu.dmpGetFIFOPacketSize();
</span></span><span style=display:flex><span>  } <span style=color:#ff79c6>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// ERROR!
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// 1 = initial memory load failed
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// 2 = DMP configuration updates failed
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// (if it&#39;s going to break, usually the code will be 1)
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    Serial.print(F(<span style=color:#f1fa8c>&#34;DMP Initialization failed (code &#34;</span>));
</span></span><span style=display:flex><span>    Serial.print(devStatus);
</span></span><span style=display:flex><span>    Serial.println(F(<span style=color:#f1fa8c>&#34;)&#34;</span>));
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#6272a4>// setup_task();
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  mpu.dmpGetCurrentFIFOPacket(fifoBuffer);
</span></span><span style=display:flex><span>  mpu.dmpGetQuaternion(<span style=color:#ff79c6>&amp;</span>q, fifoBuffer);
</span></span><span style=display:flex><span>  mpu.dmpGetEuler(euler, <span style=color:#ff79c6>&amp;</span>q);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#8be9fd>void</span> Gyro <span style=color:#ff79c6>::</span> updateGyro(){
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>if</span> (mpu.dmpGetCurrentFIFOPacket(fifoBuffer)){
</span></span><span style=display:flex><span>    mpu.dmpGetQuaternion(<span style=color:#ff79c6>&amp;</span>q, fifoBuffer);
</span></span><span style=display:flex><span>    mpu.dmpGetEuler(euler, <span style=color:#ff79c6>&amp;</span>q);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></details><p>Next, in programming the driving functionality, we took some measurements and used some basic geometry to convert turning radii and forward motion into motor steps (that took us way longer than it should have to figure out), and allowed for public functions that would turn the robot a certain number of degrees, move it forward a certain number of millimeters, and allow it to draw a circle with a diameter of one meter. You’ll notice we ended up getting an accurate enough turn angle without the gyroscope that we decided to comment out that functionality. However, data from the gyro can be accessed via the API and used for manual calibration.</p><p><img src=https://geometrikz.github.io/PS70/week10/blackboard.png alt=Maths></p><details><summary>Microprocessor: Driving (Click to reveal code)</summary><p><em>Driving.h</em></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#ff79c6># ifndef DRIVING_H
</span></span></span><span style=display:flex><span><span style=color:#ff79c6># define DRIVING_H
</span></span></span><span style=display:flex><span><span style=color:#ff79c6># include &lt;AccelStepper.h&gt;
</span></span></span><span style=display:flex><span><span style=color:#ff79c6># include &lt;Arduino.h&gt;
</span></span></span><span style=display:flex><span><span style=color:#ff79c6># include &#34;Gyro.h&#34;
</span></span></span><span style=display:flex><span><span style=color:#ff79c6># include &lt;ArduinoJson.h&gt;
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>Driving</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>private</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span>    AccelStepper stepper1;
</span></span><span style=display:flex><span>    AccelStepper stepper2;
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>int</span> maxSpeed;
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>int</span> maxAccel;
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>int</span> motorStepsPerRevolution;
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>float</span> <span style=color:#50fa7b>machineToMotor</span>(<span style=color:#8be9fd>float</span> machine_degrees);
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>float</span> <span style=color:#50fa7b>forwardToMotor</span>(<span style=color:#8be9fd>float</span> forward_mm);
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>execute</span>(<span style=color:#8be9fd>float</span> deg1, <span style=color:#8be9fd>float</span> deg2);
</span></span><span style=display:flex><span>    Gyro myGyro <span style=color:#ff79c6>=</span> Gyro(<span style=color:#f1fa8c>&#34;&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>motorReset</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>public</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span>    Driving(<span style=color:#8be9fd>int</span> pin1, <span style=color:#8be9fd>int</span> pin2, <span style=color:#8be9fd>int</span> pin3, <span style=color:#8be9fd>int</span> pin4, <span style=color:#8be9fd>int</span> maxSpeed, <span style=color:#8be9fd>int</span> maxAccel, <span style=color:#8be9fd>int</span> motorStepsPerRevolution, String url);
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>move_forward</span>(<span style=color:#8be9fd>float</span> forward_mm);
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>turn</span>(<span style=color:#8be9fd>float</span> machine_degrees);
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>setup</span>();
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>draw_circle</span>(<span style=color:#8be9fd>float</span> diameter);
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>sendGyro</span>();
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6># endif
</span></span></span></code></pre></div><p><em>Driving.cpp</em></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#ff79c6># include &#34;Driving.h&#34;
</span></span></span><span style=display:flex><span><span style=color:#ff79c6># include &lt;Arduino.h&gt;
</span></span></span><span style=display:flex><span><span style=color:#ff79c6># include &#34;Gyro.h&#34;
</span></span></span><span style=display:flex><span><span style=color:#ff79c6># include &lt;AccelStepper.h&gt;
</span></span></span><span style=display:flex><span><span style=color:#ff79c6># include &lt;Arduino.h&gt;
</span></span></span><span style=display:flex><span><span style=color:#ff79c6># include &#34;I2Cdev.h&#34;
</span></span></span><span style=display:flex><span><span style=color:#ff79c6># include &#34;MPU6050_6Axis_MotionApps20.h&#34;
</span></span></span><span style=display:flex><span><span style=color:#ff79c6># include &lt;ArduinoJson.h&gt;
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span><span style=color:#ff79c6># define PI 3.1415926535897932384626433832795
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span><span style=color:#6272a4>// #define WHEEL_RADIUS 34.0
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6># define WHEEL_RADIUS 40.0
</span></span></span><span style=display:flex><span><span style=color:#ff79c6># define TURNING_RADIUS 136
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span>Driving <span style=color:#ff79c6>::</span> Driving(<span style=color:#8be9fd>int</span> pin1, <span style=color:#8be9fd>int</span> pin2, <span style=color:#8be9fd>int</span> pin3, <span style=color:#8be9fd>int</span> pin4, <span style=color:#8be9fd>int</span> maxSp, <span style=color:#8be9fd>int</span> maxAc, <span style=color:#8be9fd>int</span> motorSPR, String url) {
</span></span><span style=display:flex><span>  myGyro <span style=color:#ff79c6>=</span> Gyro(url);
</span></span><span style=display:flex><span>  stepper1 <span style=color:#ff79c6>=</span> AccelStepper(AccelStepper<span style=color:#ff79c6>::</span>DRIVER, pin1, pin2);
</span></span><span style=display:flex><span>  stepper2 <span style=color:#ff79c6>=</span> AccelStepper(AccelStepper<span style=color:#ff79c6>::</span>DRIVER, pin3, pin4);
</span></span><span style=display:flex><span>  maxSpeed <span style=color:#ff79c6>=</span> maxSp;
</span></span><span style=display:flex><span>  maxAccel <span style=color:#ff79c6>=</span> maxAc;
</span></span><span style=display:flex><span>  motorStepsPerRevolution <span style=color:#ff79c6>=</span> motorSPR;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>void</span> Driving <span style=color:#ff79c6>::</span> motorReset() {
</span></span><span style=display:flex><span>  stepper1.setMaxSpeed(maxSpeed);
</span></span><span style=display:flex><span>  stepper1.setAcceleration(maxAccel);
</span></span><span style=display:flex><span>  stepper2.setMaxSpeed(maxSpeed);
</span></span><span style=display:flex><span>  stepper2.setAcceleration(maxAccel);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>void</span> Driving <span style=color:#ff79c6>::</span> setup() {
</span></span><span style=display:flex><span>  motorReset();
</span></span><span style=display:flex><span>  myGyro.gyroSetup();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// Converts machine turning degrees to motor degrees
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#8be9fd>float</span> Driving <span style=color:#ff79c6>::</span> machineToMotor(<span style=color:#8be9fd>float</span> machine_degrees) {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> machine_degrees <span style=color:#ff79c6>*</span> TURNING_RADIUS <span style=color:#ff79c6>/</span> (WHEEL_RADIUS);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// Converts forward distance (in cm) to motor degrees
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#8be9fd>float</span> Driving <span style=color:#ff79c6>::</span> forwardToMotor(<span style=color:#8be9fd>float</span> forward_cm) {
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>return</span> forward_cm <span style=color:#ff79c6>*</span><span style=color:#bd93f9>180</span> <span style=color:#ff79c6>/</span> (PI<span style=color:#ff79c6>*</span> WHEEL_RADIUS);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// Loops through to execute whatever commands are sent to the two motors
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#8be9fd>void</span> Driving <span style=color:#ff79c6>::</span> execute(<span style=color:#8be9fd>float</span> deg1, <span style=color:#8be9fd>float</span> deg2) {
</span></span><span style=display:flex><span>  stepper1.setCurrentPosition(<span style=color:#bd93f9>0</span>);
</span></span><span style=display:flex><span>  stepper2.setCurrentPosition(<span style=color:#bd93f9>0</span>);
</span></span><span style=display:flex><span>  delay(<span style=color:#bd93f9>100</span>);
</span></span><span style=display:flex><span>  stepper1.moveTo(deg1);
</span></span><span style=display:flex><span>  stepper2.moveTo(deg2);
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>while</span> (stepper1.distanceToGo() <span style=color:#ff79c6>!=</span> <span style=color:#bd93f9>0</span> <span style=color:#ff79c6>&amp;&amp;</span> stepper2.distanceToGo() <span style=color:#ff79c6>!=</span> <span style=color:#bd93f9>0</span>) {
</span></span><span style=display:flex><span>    stepper1.run();
</span></span><span style=display:flex><span>    stepper2.run();
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// myGyro.updateGyro();
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// myGyro.sendGyro();
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// moves machine forward x centimeters
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#8be9fd>void</span> Driving <span style=color:#ff79c6>::</span> move_forward(<span style=color:#8be9fd>float</span> forward_cm) {
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>float</span> degrees <span style=color:#ff79c6>=</span> forwardToMotor(forward_cm) <span style=color:#ff79c6>*</span> motorStepsPerRevolution<span style=color:#ff79c6>/</span><span style=color:#bd93f9>360</span>;
</span></span><span style=display:flex><span>  execute(degrees, degrees);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// Turns machine X degrees
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#8be9fd>void</span> Driving <span style=color:#ff79c6>::</span> turn(<span style=color:#8be9fd>float</span> machine_degrees) {
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>float</span> degrees <span style=color:#ff79c6>=</span> machineToMotor(machine_degrees) <span style=color:#ff79c6>*</span> motorStepsPerRevolution<span style=color:#ff79c6>/</span><span style=color:#bd93f9>360</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#6272a4>// set up gyro
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#8be9fd>float</span> current_degrees <span style=color:#ff79c6>=</span> myGyro.getCurrentAngle();
</span></span><span style=display:flex><span>  execute(<span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span><span style=color:#ff79c6>*</span>degrees, degrees);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#6272a4>// Uncomment to act on degree change.
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>// need to worry about measurements getting cut off and also direction.
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>// float degree_change = myGyro.getCurrentDegrees() - current_degrees;
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>// if (abs(machine_degrees - degree_change) &gt; 5) {
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>//   turn(machine_degrees - degree_change);
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>// }
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>void</span> Driving <span style=color:#ff79c6>::</span> draw_circle(<span style=color:#8be9fd>float</span> diameter) {
</span></span><span style=display:flex><span>  <span style=color:#6272a4>// Go to outside of
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#8be9fd>float</span> max_speed <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>150</span>;
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>float</span> max_accel <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>4000</span>;
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>float</span> inner_distance <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>1.9</span> <span style=color:#ff79c6>*</span>PI<span style=color:#ff79c6>*</span> (diameter <span style=color:#ff79c6>-</span> TURNING_RADIUS<span style=color:#ff79c6>*</span><span style=color:#bd93f9>2</span>); <span style=color:#6272a4>// no /2
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#8be9fd>float</span> outer_distance <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>1.9</span><span style=color:#ff79c6>*</span>PI <span style=color:#ff79c6>*</span>(diameter <span style=color:#ff79c6>+</span> TURNING_RADIUS<span style=color:#ff79c6>*</span><span style=color:#bd93f9>2</span>);
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>float</span> inner_val <span style=color:#ff79c6>=</span> inner_distance <span style=color:#ff79c6>/</span> (inner_distance <span style=color:#ff79c6>+</span> outer_distance);
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>float</span> outer_val <span style=color:#ff79c6>=</span> outer_distance <span style=color:#ff79c6>/</span> (inner_distance <span style=color:#ff79c6>+</span> outer_distance);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  stepper1.setMaxSpeed(max_speed <span style=color:#ff79c6>*</span>inner_val);
</span></span><span style=display:flex><span>  stepper1.setAcceleration(max_accel<span style=color:#ff79c6>*</span>inner_val);
</span></span><span style=display:flex><span>  stepper2.setMaxSpeed(max_speed <span style=color:#ff79c6>*</span>outer_val);
</span></span><span style=display:flex><span>stepper2.setAcceleration(max_accel<span style=color:#ff79c6>*</span> outer_val);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>float</span> degrees1 <span style=color:#ff79c6>=</span> forwardToMotor(inner_distance) <span style=color:#ff79c6>*</span>motorStepsPerRevolution<span style=color:#ff79c6>/</span><span style=color:#bd93f9>360</span>;
</span></span><span style=display:flex><span><span style=color:#8be9fd>float</span> degrees2 <span style=color:#ff79c6>=</span> forwardToMotor(outer_distance)<span style=color:#ff79c6>*</span> motorStepsPerRevolution<span style=color:#ff79c6>/</span><span style=color:#bd93f9>360</span>;
</span></span><span style=display:flex><span>  execute(degrees2, degrees1);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>void</span> Driving <span style=color:#ff79c6>::</span> sendGyro(){
</span></span><span style=display:flex><span>  myGyro.sendGyro();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></details><p>Finally, we put these parts together in a main file that controlled the pump, and read commands from our server and executed them one by one:</p><details><summary>Microprocessor: Arduino (Click to reveal code)</summary><p><em>drawing_robot.ino</em></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#ff79c6># include &lt;AccelStepper.h&gt;
</span></span></span><span style=display:flex><span><span style=color:#ff79c6># include &lt;WiFi.h&gt;
</span></span></span><span style=display:flex><span><span style=color:#ff79c6># include &#34;gyro.h&#34;
</span></span></span><span style=display:flex><span><span style=color:#ff79c6># include &lt;HTTPClient.h&gt;
</span></span></span><span style=display:flex><span><span style=color:#ff79c6># include &lt;ArduinoJson.h&gt;
</span></span></span><span style=display:flex><span><span style=color:#ff79c6># include &#34;Driving.h&#34;
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span><span style=color:#6272a4>// #include &lt;Wire.h&gt;
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span><span style=color:#ff79c6># define MAX_ACCELERATION 50
</span></span></span><span style=display:flex><span><span style=color:#ff79c6># define MAX_SPEED 200
</span></span></span><span style=display:flex><span><span style=color:#ff79c6># define WATER_PIN 40
</span></span></span><span style=display:flex><span><span style=color:#ff79c6># define INTERRUPT_PIN 2
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// Connect to WiFi
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>const</span> <span style=color:#8be9fd>char</span><span style=color:#ff79c6>*</span>ssid <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;MAKERSPACE&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> <span style=color:#8be9fd>char</span><span style=color:#ff79c6>*</span> password <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;12345678&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#8be9fd>bool</span> first_read <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>true</span>;
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> id;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// Set up server for reading instructions
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>const</span> String apiURL <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;&lt;https://ps70-api.vercel.app/&gt;&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> String gyroURL <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;&lt;https://ps70-api.vercel.app/gyro&gt;&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// Define motor pin connections
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>const</span> <span style=color:#8be9fd>int</span> motorPin1 <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>11</span>;
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> <span style=color:#8be9fd>int</span> motorPin2 <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>10</span>;
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> <span style=color:#8be9fd>int</span> motorPin3 <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>7</span>;
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> <span style=color:#8be9fd>int</span> motorPin4 <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>6</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// Define the motor steps per revolution
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>const</span> <span style=color:#8be9fd>int</span> motorStepsPerRevolution <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>200</span>;
</span></span><span style=display:flex><span><span style=color:#8be9fd>long</span> old_id <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Driving driver <span style=color:#ff79c6>=</span> Driving(motorPin1, motorPin2, motorPin3, motorPin4, MAX_SPEED, MAX_ACCELERATION, motorStepsPerRevolution, gyroURL);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>setup</span>() {
</span></span><span style=display:flex><span>  <span style=color:#6272a4>// Set max speed and acceleration
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  driver.setup();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#6272a4>// Set up water pump pin
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  pinMode(WATER_PIN, OUTPUT);
</span></span><span style=display:flex><span>  Serial.begin(<span style=color:#bd93f9>115200</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#6272a4>// Set up WiFi
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  WiFi.begin(ssid, password);
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>while</span> (WiFi.status() <span style=color:#ff79c6>!=</span> WL_CONNECTED) {
</span></span><span style=display:flex><span>    delay(<span style=color:#bd93f9>1000</span>);
</span></span><span style=display:flex><span>    Serial.println(<span style=color:#f1fa8c>&#34;Connecting to WiFi&#34;</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  Serial.println(<span style=color:#f1fa8c>&#34;Connected to the WiFi network&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>toggle_pump</span>(<span style=color:#8be9fd>int</span> on) {
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>if</span> (on) {
</span></span><span style=display:flex><span>    digitalWrite(WATER_PIN, LOW);
</span></span><span style=display:flex><span>  } <span style=color:#ff79c6>else</span> {
</span></span><span style=display:flex><span>    digitalWrite(WATER_PIN, HIGH);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>draw_circle</span>(<span style=color:#8be9fd>float</span> diameter) {
</span></span><span style=display:flex><span>  toggle_pump(<span style=color:#bd93f9>1</span>);
</span></span><span style=display:flex><span>  delay(<span style=color:#bd93f9>300</span>);
</span></span><span style=display:flex><span>  toggle_pump(<span style=color:#bd93f9>0</span>);
</span></span><span style=display:flex><span>  driver.move_forward(diameter <span style=color:#ff79c6>/</span> <span style=color:#bd93f9>2</span>);
</span></span><span style=display:flex><span>  driver.turn(<span style=color:#bd93f9>90</span>);
</span></span><span style=display:flex><span>  toggle_pump(<span style=color:#bd93f9>1</span>);
</span></span><span style=display:flex><span>  driver.draw_circle(diameter);
</span></span><span style=display:flex><span>  toggle_pump(<span style=color:#bd93f9>0</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>loop</span>() {
</span></span><span style=display:flex><span>  <span style=color:#6272a4>// Serial.println(&#34;Refreshing&#34;);
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#ff79c6>if</span> ((WiFi.status() <span style=color:#ff79c6>==</span> WL_CONNECTED)) {
</span></span><span style=display:flex><span>    HTTPClient http;
</span></span><span style=display:flex><span>    http.begin(apiURL);
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>int</span> httpResponseCode <span style=color:#ff79c6>=</span> http.GET();
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> (httpResponseCode <span style=color:#ff79c6>&gt;</span> <span style=color:#bd93f9>0</span>) {
</span></span><span style=display:flex><span>      String payload <span style=color:#ff79c6>=</span> http.getString();
</span></span><span style=display:flex><span>      DynamicJsonDocument doc(<span style=color:#bd93f9>8192</span>);
</span></span><span style=display:flex><span>      DeserializationError error <span style=color:#ff79c6>=</span> deserializeJson(doc, payload);
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>if</span> (error) {
</span></span><span style=display:flex><span>        Serial.println(<span style=color:#f1fa8c>&#34;Deserialization Error&#34;</span>);
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      http.end();
</span></span><span style=display:flex><span>      driver.sendGyro();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      id <span style=color:#ff79c6>=</span> doc[<span style=color:#f1fa8c>&#34;id&#34;</span>];
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>if</span> (id <span style=color:#ff79c6>!=</span> old_id <span style=color:#ff79c6>&amp;&amp;</span> <span style=color:#ff79c6>!</span>first_read) {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> (id <span style=color:#ff79c6>&gt;</span> <span style=color:#bd93f9>0</span>) {
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>for</span> (JsonObject <span style=color:#8be9fd;font-style:italic>instruction</span> : doc[<span style=color:#f1fa8c>&#34;instructions&#34;</span>].as<span style=color:#ff79c6>&lt;</span>JsonArray<span style=color:#ff79c6>&gt;</span>()) {
</span></span><span style=display:flex><span>            <span style=color:#8be9fd>double</span> instruction_angle <span style=color:#ff79c6>=</span> instruction[<span style=color:#f1fa8c>&#34;angle&#34;</span>];
</span></span><span style=display:flex><span>            <span style=color:#8be9fd>double</span> instruction_distance <span style=color:#ff79c6>=</span> instruction[<span style=color:#f1fa8c>&#34;distance&#34;</span>];
</span></span><span style=display:flex><span>            <span style=color:#8be9fd>int</span> instruction_pendown <span style=color:#ff79c6>=</span> instruction[<span style=color:#f1fa8c>&#34;pendown&#34;</span>];
</span></span><span style=display:flex><span>            toggle_pump(<span style=color:#bd93f9>0</span>);
</span></span><span style=display:flex><span>            driver.turn(instruction_angle);
</span></span><span style=display:flex><span>            toggle_pump(instruction_pendown);
</span></span><span style=display:flex><span>            driver.move_forward(instruction_distance);
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>        } <span style=color:#ff79c6>else</span> {
</span></span><span style=display:flex><span>          toggle_pump(<span style=color:#bd93f9>1</span>);
</span></span><span style=display:flex><span>          draw_circle(<span style=color:#bd93f9>1000</span>);
</span></span><span style=display:flex><span>          toggle_pump(<span style=color:#bd93f9>0</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      old_id <span style=color:#ff79c6>=</span> id;
</span></span><span style=display:flex><span>      toggle_pump(<span style=color:#bd93f9>0</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    first_read <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>false</span>;
</span></span><span style=display:flex><span>    driver.setup();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></details><p>This was a big project on the software side, and we ran into quite a few problems integrating all the different parts of the project, but after lots and lots and lots of debugging, the code came together and we had a working product!</p><h4 id=end-effector>End effector</h4><p>Although we had originally intended on simply using a pen or something similar as our end effector, we suddenly considered how much cooler it would be to create our drawings with isopropyl/rubbing alcohol, then light it on fire!</p><p>And then we considered how much safer it would be to create those drawings with water!</p><p>Thus, our end effector was a mini pump that drew from a water container on the chassis. We used this relay module tutorial from Random Nerd Tutorials to control the flow of the pump using a 5V 2-channel relay module (though you only need one of these channels). The code itself is simple, sending LOW to the relay pin to get the current flowing, and HIGH to stop the current. A few tests proved the flow and stop to be rather immediate.</p><p>Below is the relay code, which got integrated into the full code later on.</p><details><summary>End Effector (Click to reveal code)</summary><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#6272a4>//changed from 26
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>const</span> <span style=color:#8be9fd>int</span> relay <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>40</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>setup</span>() {
</span></span><span style=display:flex><span>  Serial.begin(<span style=color:#bd93f9>115200</span>);
</span></span><span style=display:flex><span>  pinMode(relay, OUTPUT);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>loop</span>() {
</span></span><span style=display:flex><span>  <span style=color:#6272a4>// Normally Open configuration, send LOW signal to let current flow
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>// (if you&#39;re usong Normally Closed configuration send HIGH signal)
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  digitalWrite(relay, LOW);
</span></span><span style=display:flex><span>  Serial.println(<span style=color:#f1fa8c>&#34;Current Flowing&#34;</span>);
</span></span><span style=display:flex><span>  delay(<span style=color:#bd93f9>5000</span>);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#6272a4>// Normally Open configuration, send HIGH signal stop current flow
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#6272a4>// (if you&#39;re usong Normally Closed configuration send LOW signal)
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  digitalWrite(relay, HIGH);
</span></span><span style=display:flex><span>  Serial.println(<span style=color:#f1fa8c>&#34;Current not Flowing&#34;</span>);
</span></span><span style=display:flex><span>  delay(<span style=color:#bd93f9>1000</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></details><h3 id=end-product>End product</h3><p>The robot ended up working just as well as we had hoped, and we were really happy with it’s performance outdoors! Here are some pictures and videos of the action!</p><p><strong>Drawing a star</strong></p><iframe width=843 height=474 src=https://www.youtube.com/embed/XGXfDdbjJo8 title="star demo" frameborder=0 allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe><p><strong>Drawing a circle</strong></p><iframe width=843 height=474 src=https://www.youtube.com/embed/9HmAaRooH9c title="circle demo" frameborder=0 allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe></article></div><hr class="relative h-px my-8 bg-gray-200 border-0 dark:bg-gray-700 max-w-4xl mx-auto"><div class="giscus w-full mx-auto pt-4 max-w-4xl"><script>function changeGiscusTheme(){const e=document.documentElement.getAttribute("class")==="dark"?"light":"dark";function t(e){const t=document.querySelector("iframe.giscus-frame");if(!t)return;t.contentWindow.postMessage({giscus:e},"https://giscus.app")}t({setConfig:{theme:e}})}const modeToggle=document.querySelector(".toggle-dark-mode");modeToggle&&modeToggle.addEventListener("click",changeGiscusTheme)</script><script>let giscusTheme=localStorage.getItem("darkmode"),giscusAttributes={src:"https://giscus.app/client.js","data-repo":"geometrikz/ps70","data-repo-id":"R_kgDOI6narQ","data-category":"Announcements","data-category-id":"DIC_kwDOI6narc4CUEG2","data-mapping":"title","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"top","data-theme":giscusTheme,"data-lang":"en",crossorigin:"anonymous",async:""},giscusScript=document.createElement("script");Object.entries(giscusAttributes).forEach(([e,t])=>giscusScript.setAttribute(e,t)),document.body.appendChild(giscusScript)</script></div></main><footer class="container p-6 mx-auto flex justify-between items-center"><span class="text-sm font-light">2023 © PS70: Intro to Digital Fabrication</span>
<span onclick='window.scrollTo({top:0,behavior:"smooth"})' class="p-1 cursor-pointer"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 15l-6-6-6 6h12"/></svg></span></footer><div class="search-ui absolute top-0 left-0 w-full h-full bg-white dark:bg-gray-800 hidden"><div class="container max-w-3xl mx-auto p-12"><div class=relative><div class="my-4 text-center text-2xl font-bold">Search</div><span class="p-2 absolute right-0 top-0 cursor-pointer close-search"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></span></div><input type=search class="py-2 px-3 w-full dark:text-black border dark:border-transparent" placeholder="Enter search query"><div class="search-results text-lg font-medium my-4 hidden">Results</div><ul class="search-list my-2"></ul><div class="no-results text-center my-8 hidden"><div class="text-xl font-semibold mb-2">No results found</div><p class="font-light text-sm">Try adjusting your search query</p></div></div></div><script src=https://geometrikz.github.io/PS70/js/scripts.min.js></script>
<script>const darkmode=document.querySelector(".toggle-dark-mode");function toggleDarkMode(){document.documentElement.classList.contains("dark")?(document.documentElement.classList.remove("dark"),localStorage.setItem("darkmode","light")):(document.documentElement.classList.add("dark"),localStorage.setItem("darkmode","dark"))}darkmode&&darkmode.addEventListener("click",toggleDarkMode);const darkStorage=localStorage.getItem("darkmode"),isBrowserDark=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;!darkStorage&&isBrowserDark&&document.documentElement.classList.add("dark"),darkStorage&&darkStorage==="dark"&&toggleDarkMode()</script><script>const mobileMenuButton=document.querySelector(".mobile-menu-button"),mobileMenu=document.querySelector(".mobile-menu");function toggleMenu(){mobileMenu.classList.toggle("hidden"),mobileMenu.classList.toggle("flex")}mobileMenu&&mobileMenuButton&&mobileMenuButton.addEventListener("click",toggleMenu)</script></body></html>